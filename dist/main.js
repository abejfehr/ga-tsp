!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e){t.exports=function t(e){function n(t,e){if((t=t||{}).mutationFunction=t.mutationFunction||e.mutationFunction,t.crossoverFunction=t.crossoverFunction||e.crossoverFunction,t.fitnessFunction=t.fitnessFunction||e.fitnessFunction,t.doesABeatBFunction=t.doesABeatBFunction||e.doesABeatBFunction,t.population=t.population||e.population,t.population.length<=0)throw Error("population must be an array and contain at least 1 phenotypes");if(t.populationSize=t.populationSize||e.populationSize,t.populationSize<=0)throw Error("populationSize must be greater than 0");return t}var o=n(e,{mutationFunction:function(t){return t},crossoverFunction:function(t,e){return[t,e]},fitnessFunction:function(t){return 0},doesABeatBFunction:void 0,population:[],populationSize:100});function i(t){return JSON.parse(JSON.stringify(t))}function r(t){return o.mutationFunction(i(t))}function s(t){t=i(t);var e=o.population[Math.floor(Math.random()*o.population.length)];return e=i(e),o.crossoverFunction(t,e)[0]}return{evolve:function(t){return t&&(o=n(t,o)),function(){for(var t=o.population.length;o.population.length<o.populationSize;)o.population.push(r(i(o.population[Math.floor(Math.random()*t)])))}(),function(){for(var t=0;t<o.population.length;t++){var e=Math.floor(Math.random()*o.population.length),n=o.population[e];o.population[e]=o.population[t],o.population[t]=n}}(),function(){for(var t,e,n=[],i=0;i<o.population.length-1;i+=2){var u=o.population[i],c=o.population[i+1];n.push(u),t=u,e=c,(o.doesABeatBFunction?o.doesABeatBFunction(t,e):o.fitnessFunction(t)>=o.fitnessFunction(e))?Math.random()<.5?n.push(r(u)):n.push(s(u)):n.push(c)}o.population=n}(),this},best:function(){var t=this.scoredPopulation();return i(t.reduce((function(t,e){return t.score>=e.score?t:e}),t[0]).phenotype)},bestScore:function(){return o.fitnessFunction(this.best())},population:function(){return i(this.config().population)},scoredPopulation:function(){return this.population().map((function(t){return{phenotype:i(t),score:o.fitnessFunction(t)}}))},config:function(){return i(o)},clone:function(e){return t(n(e,n(this.config(),o)))}}}},function(t,e,n){"use strict";n.r(e);var o=n(0),i=n.n(o);const r=(t,e,n=!1)=>{console.log("A graph is being drawn");const o=t.getContext("2d");o.clearRect(0,0,t.width,t.height);for(let n=0;n<e.edges.length;++n){o.strokeStyle=e.edges[n].color;const i=e.edges[n].source,r=e.edges[n].target,s=e.nodes.find(t=>t.id===i),u=e.nodes.find(t=>t.id===r);o.beginPath(),o.moveTo(s.x*t.width,s.y*t.height),o.lineTo(u.x*t.width,u.y*t.height),o.stroke()}for(let n=0;n<e.nodes.length;++n)o.beginPath(),o.fillStyle="#555",o.ellipse(e.nodes[n].x*t.width,e.nodes[n].y*t.height,3,3,0,0,2*Math.PI),o.stroke(),o.fill()};const s={nodes:[],edges:[]};for(let t=0;t<20;t++)s.nodes.push({id:"n"+t,x:Math.random(),y:Math.random(),size:.2,color:"#666"});const u=document.querySelector("#main-graph-container canvas");u.width=u.getBoundingClientRect().width,u.height=u.getBoundingClientRect().height,r(u,s);const c=new class{constructor(t){this.nodesById={};const e=t.nodes.map(t=>(this.nodesById[t.id]=t,t.id));this.memo={};const n=Array(100).fill().map(()=>(t=>{for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t})(e)),o={mutationFunction:this.mutationFunction.bind(this),crossoverFunction:this.crossoverFunction.bind(this),fitnessFunction:this.fitnessFunction.bind(this),population:n,populationSize:500};this.geneticAlgorithm=i()(o),this.best=[],this.previousBestScore=0,this.generation=1,console.log("Distance is "+-1*this.fitnessFunction(this.best))}evolve(){return new Promise(t=>{for(var e=0;e<10;e++)console.log("Generation "+this.generation++),this.geneticAlgorithm.evolve();var n=this.geneticAlgorithm.bestScore();this.previousBestScore=n,this.best=this.geneticAlgorithm.best(),console.log("Distance is "+-1*n),t({best:this.best,scoredPopulation:this.geneticAlgorithm.scoredPopulation()})})}mutationFunction(t){var e=Math.floor(Math.random()*t.length),n=Math.floor(Math.random()*t.length),o=t[e];return t[e]=t[n],t[n]=o,t}helper_concat(t,e,n){return e.slice(0,t).concat(n.slice(t)).concat(e.slice(t))}helper_removeDuplicates(t){var e={};return t.filter((function(t){return!e[JSON.stringify(t)]&&(e[JSON.stringify(t)]=!0,!0)}))}crossoverFunction(t,e){var n=Math.round(Math.random()*t.length);return[this.helper_removeDuplicates(this.helper_concat(n,t,e)),this.helper_removeDuplicates(this.helper_concat(n,e,t))]}fitnessFunction(t){if(this.memo[t.join("")])return console.log("cache hit!"),this.memo[t.join("")];var e=t[0],n=t.slice(1).map((function(t){const n=[e,t];return e=t,n})).reduce((t,e)=>{const n=this.nodesById[e[0]],o=this.nodesById[e[1]];return t+(i=n,r=o,Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)));var i,r},0);return this.memo[JSON.stringify(t)]=-1*n,-1*n}}(s),a=[0,1,2,3,4,5,6,7,8,9,"a","b","c"].map(t=>`#${t}${t}${t}`);document.querySelector("button").addEventListener("click",()=>{c.evolve().then(({best:t,scoredPopulation:e})=>{if(s.edges.length)for(let e=0;e<t.length;++e){const n=a.findIndex(t=>t===s.edges[e].color),o=Math.min(n+1,a.length-1);s.edges[e].color=a[o],s.edges[e].size=a.length-n,s.edges[e].source!==t[e]&&(s.edges[e].source=t[e],s.edges[e].color="#000"),s.edges[e].target!==t[(e+1)%t.length]&&(s.edges[e].target=t[(e+1)%t.length],s.edges[e].color="#000")}else{s.edges=[];for(let e=0;e<t.length;e++)s.edges.push({id:"e"+e,source:t[e],target:t[(e+1)%t.length],size:1,color:"#000"})}const n=(t,e)=>{const n=JSON.parse(JSON.stringify(t));n.edges=[];for(let t=0;t<e.length;t++)n.edges.push({id:"e"+t,source:e[t],target:e[(t+1)%e.length],size:1,color:"#000"});return n};r(u,s);const o=u.width/u.height,i=e.sort((t,e)=>-1*t.score- -1*e.score).slice(0,5);for(let t=0;t<i.length;++t){const e=document.querySelector(".top-"+(t+1)),u=document.querySelector(`.top-${t+1} .score`),c=e.querySelector("canvas");console.log("canvas",c),c.width=c.getBoundingClientRect().width,c.height=c.getBoundingClientRect().width/o,u.innerHTML="Score: "+~~(-1*i[t].score*1e3);const a=n(s,i[t].phenotype);r(c,a)}})})}]);